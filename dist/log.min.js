const VDDateHelper=require("./date.js"),VDFileHelper=require("./file.js"),VDStringHelper=require("./string.js"),VDNumberHelper=require("./number.js"),VDGenericHelper=require("./generic.js"),fs=require("fs"),path=require("path");require("dotenv").config();class VDLogHelper{static get CONFIGS(){const e=process.env.VD_LOG_GC_DIVISOR??0;let s={PATH_LOGS:path.join(process.cwd(),process.env.VD_LOG_FOLDERNAME??"logs")+path.sep,LOG_EXT:process.env.VD_LOG_EXTENSION??".log",NOW:VDDateHelper.getNow(process.env.VD_LOG_TIMEZONE??"America/Sao_Paulo","YYYY-MM-DD"),FILE_COUNT:1,MAX_SIZE_MB:process.env.VD_LOG_MAXSIZEMB_PER_FILE??300,LOG_LIMIT_TYPE:process.env.VD_LOG_LIMIT_UNITY??"days",LOG_LIMIT:process.env.VD_LOG_LIMIT_VALUE??7,GC:{PROBABILITY:process.env.VD_LOG_GC_PROBABILITY??5,DIVISOR:e<=0?100:e}};const r=1024*s.MAX_SIZE_MB*1024;try{if(fs.existsSync(s.PATH_LOGS)){fs.readdirSync(s.PATH_LOGS).forEach((e=>{e.endsWith(s.LOG_EXT)&&e.startsWith(s.NOW)&&VDFileHelper.getFileSize(path.join(s.PATH_LOGS,e))>r&&s.FILE_COUNT++}))}}catch(e){console.error("Erro ao verificar arquivos no diretÃ³rio de logs:",e)}return s.FILE_NAME=s.NOW+"-"+s.FILE_COUNT+s.LOG_EXT,s.FILE_PATH=path.join(s.PATH_LOGS,s.FILE_NAME),s}static get LOG_LIMIT_MS(){let e=0;switch(this.CONFIGS.LOG_LIMIT_TYPE.toLowerCase()){case"d":case"day":case"days":e=24*this.CONFIGS.LOG_LIMIT*60*60*1e3;break;case"h":case"hour":case"hours":e=60*this.CONFIGS.LOG_LIMIT*60*1e3;break;case"m":case"min":case"mins":case"minute":case"minutes":e=60*this.CONFIGS.LOG_LIMIT*1e3;break;case"s":case"sec":case"secs":case"second":case"seconds":e=1e3*this.CONFIGS.LOG_LIMIT}return e}static showMessageError(){console.error("[31m%s[0m","NÃ£o foi possÃ­vel inicializar o sistema de logs! Por favor, verifique as permissÃµes de pastas! O integrador possui direitos administrativos?")}static initialize(){return!!VDFileHelper.createFolder(this.CONFIGS.PATH_LOGS)||(this.showMessageError(),!1)}static garbageCollector(e=!1){if(!e&&VDNumberHelper.getRandomInt(1,this.CONFIGS.GC.DIVISOR)>this.CONFIGS.GC.PROBABILITY)return!1;try{const e=fs.readdirSync(this.CONFIGS.PATH_LOGS),s=Date.now();return e.forEach((e=>{const r=path.join(this.CONFIGS.PATH_LOGS,e),t=fs.statSync(r);s-t.mtime.getTime()>this.LOG_LIMIT_MS&&fs.unlinkSync(r)})),!0}catch(e){return this.showMessageError(),!1}}static add(e,s){if(e&&e.length>0){const r=VDDateHelper.getNow("America/Sao_Paulo","YYYY-MM-DD HH:mm:ss")+" "+s+" > "+e+"\n",t=this.CONFIGS.FILE_PATH;VDFileHelper.appendStringToFile(t,r)||this.showMessageError()}this.initialize(),this.garbageCollector()}static addInfo(e){this.add(VDStringHelper.removeTags(e),"INFO")}static addWarning(e){this.add(VDStringHelper.removeTags(e),"WARN")}static addError(e){this.add(VDStringHelper.removeTags(e),"ERRO")}static addException(e){this.add(VDGenericHelper.returnStackTrace(e),"ERRO")}}module.exports=VDLogHelper;