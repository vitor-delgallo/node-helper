const{Octokit:Octokit}=require("@octokit/rest"),VDGenericHelper=require("./generic.min.js"),fs=require("fs");require("dotenv").config();class VDGithubHelper{static get CONFIGS(){return{token:process.env.VD_GITHUB_TOKEN??null,owner:process.env.VD_GITHUB_OWNER??null,maxTentativas:process.env.VD_GITHUB_RETRYS??3,commitAuthor:{name:process.env.VD_GITHUB_AUTHOR??null,email:process.env.VD_GITHUB_EMAIL_AUTHOR??null}}}static octokit=new Octokit({auth:this.CONFIGS.token});static async uploadFile(t,e,o,r,a=null,i=1){try{const i=fs.readFileSync(o,"utf8"),s=Buffer.from(i).toString("base64");let n;try{const{data:o}=await this.octokit.repos.getContent({owner:this.CONFIGS.owner,repo:t,path:r,ref:e});n=o.sha}catch(t){if(404!==t.status)return console.error("Erro ao verificar existência do arquivo:",t),!1}return await this.octokit.repos.createOrUpdateFileContents({owner:this.CONFIGS.owner,repo:t,path:r,message:a??(n?"Atualizando arquivo via integração automatizada":"Criando arquivo via integração automatizada"),content:s,sha:n,branch:e,committer:this.CONFIGS.commitAuthor,author:this.CONFIGS.commitAuthor}),console.log("Arquivo enviado com sucesso!"),!0}catch(s){return i<=this.CONFIGS.maxTentativas&&409===s.status?(await VDGenericHelper.delay(300),await this.uploadFile(t,e,o,r,a,i+1)):(console.error("Erro ao enviar arquivo:",s),!1)}}}module.exports=VDGithubHelper;